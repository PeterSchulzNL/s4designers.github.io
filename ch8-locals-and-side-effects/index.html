<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Page Title</title>
  <link rel="stylesheet" href="../css/main.css"/>
</head>
<body class="line-numbers">
 <main>

  <h1>Chapter 8:  more about functions: <i>local variables</i> and <i>side effects</i></h1>

  <p>You've seen them before: variables that are created <i>inside</i> a function. Did you wonder what happens to them when the function (call) is done, and its code stops running? <b>They disappear</b>. And when the function is called again, and it's code start running anew? <b>They are created again.</b> Welcome to the most important kind of variable in all programming languages: <i>local variables</i>.</p>
  <youtube ytid="0fs7zljFEa0"></youtube>

  <youtube ytid="S4x1qM6p4d0"></youtube>
  <!-- <section class="assignment">
      <h3 class="assignment questions">8.1: Arduino Sum</h3>
      <p> Make an arduino function that calculates the sum of three values. The function should be called like this:</p>
      <script type="text/plain" class="language-arduino">
void setup() {
  Serial.begin(9600);
  Serial.println(sum(4,3,4)); // outputs 11
  Serial.println(sum(12,8,3)); // outputs 23
  Serial.println(sum(41,13,20)); // outputs 74
}
      </script>
      <answer buttontext="Mail the code"></answer>
  </section> -->

  <!-- <section class="assignment">
      <h3 class="assignment questions">8.2: Arduino Calibration</h3>
      <p> Make an arduino function reads a value from the magnetsensor and stores it in a global variable, call this function in the setup. We are going to use this reading as a baseline to detect whether or not a magnet is near.</p>
      <answer buttontext="Mail the code"></answer>
  </section>
  <section class="assignment">
      <h3 class="assignment questions">8.3: Arduino returns</h3>
      <p> Make an arduino function that returns true if the magnet is near, and returns false if the magnet is far away. Use the value you set in with the function in 8.2.  Call the function in an if-statement that turns on a lightbulb if the magnet is far, and turns it off when the magnet is near.</p>
      <answer buttontext="Mail the code"></answer>
  </section>
  <section class="assignment">
      <h3 class="assignment questions">8.4: Side effects</h3>
      <p> Which functions in the previous assignments have a side effect, and which have a return value. </p>
      <answer buttontext="Mail the code"></answer>
  </section> -->

<section class="assignment">
    <h3 class="assignment summary">8.1 side effects</h3>

    <p>In your own words, explain: </p> 
    <ol type="text">
      <li>What a side effect is</li>
      <li>What a local variable is</li>
      <li>What a global variable is</li>
    </ol>
    <answer noslider buttontext="mail your answers"></answer>
</section>



<div class="theory">
  <h3>side effects versus return values</h3>
  <p>You could, if you want, write a function that only modifies its own local variables. This function would not return anything. Nor would it have any <i>side effects</i>, like changing global variables, or the display, or a connected thing like an LED or a buzzer. Such a function would be useful for one thing only: draining the battery of your laptop or mobile device. It would be useless for anything else, because it doesn't <i>do antything</i>, or <i>create any result value</i>.</p>
  <p>Useful functions have either…</p>
  <ul>
    <li><b>…a return value</b>, or</li>
    <li><b>…a side effect</b>, </li>
  </ul>
  <p>or both.</p>
  <p>A side effect is simply <i>any effect that lasts after the function is done, except for return values</i>. Here are some examples of side effects:</p>
  <ul>
    <li>changing global variables (the most important one)</li>
    <li>changing the display</li>
    <li>making sound</li>
    <li>changing files on the hard disk</li>
    <li>sending messages over the internet</li>
    <li>storing stuff in a database</li>
    <li>did we mention changing global variables?</li>
  </ul>
  <h4>return values are great</h4>
  <p>The reason why return values are singled-out (from all the other effects a function can have) has to do with understanding code. While you're programming, you are actually spending more time reading the code than writing it; if only because debugging is such an important part of the work. If you work in a team, reading code becomes even more important. But reading code is more like solving puzzles than it is like reading a novel. So anything you can do to make code more understandable is very much worth the effort. Return values differ from all the other kinds of effects in that <b>it is always immidiately visible how a return value influences the rest of the program while you're looking at the function call</b> in the code.</p>
  <p>A return value cannot cause hidden behavioural changes in the program. Other effects, like changing global variables from inside the function, are invisible when you're reading the function call; especially when the program becomes too big to keep all of the details of all of the functions in your head.</p>
  <p>Imagine your project involves changing a program consisting of 10.000 lines of code. You're debugging a line of code like this:</p>
  <p><code>importantValue = complexFunction() + complexFunction()</code></p>
  <p>And somehow the result is different from <code>2 * complexFunction()</code>. How could that be? What could be going on? Well, the function could be reading, and then changing, some hidden information (e.g. a global variable, a file, or a property of an HTML element on a web page). The second time it is called, it reads the data that was changed by the first call of the function, resulting in a different return value. So the global variable acts as a hidden channel of communication that you can't readily see when trying to understand that line of code. Or to say it more strongly: it acts as a link in hidden chain of cause-and-effect in your program.</p>
  <p>Would you like to debug a large piece of code where such hidden channels are everywhere? <i>Where the meaning of every line of code could be influenced by most of the other lines, and you're unable to see that?</i> This is why every programming course for beginners (including this one) discourages the use of global variables. They may be necessary sometimes, but all code is easier to improve, and fix, if you have a few globals as possible. For the same reason, we encourage you to construct your program with, as much as possible, functions that only produce return values. Such functions do not take part in invisble cause-and-effect chains. You can control their effect at the place where you call them, and everyone can easily read how you did that.</p>
  <p>That said, side effects are unavoidable in useful programs. A program where none of the code has any side effects is similar to that function that only changes its local variables: it drains the battery, and does nothing else (actually, it also heats up your processor chip). So: use all the side effects your program needs, but…</p>
  <ul>
    <li>…concentrate the side effects in a few functions; have all the other functions only create return values.</li>
    <li>…try to have the communication between parts of your program (i.e. functions) happen using paramters and return values. As much as possible, of course.</li>
    <li>…give all your functions <i>names from which you can tell if they are (primarily) for creating return values or (primarily) for causing side effects</i>. (This also means that you want to avoid creating functions that do both).</li>
  </ul>
  <br>
  <p>PS: the Dutch word for side effects in programming is “zijeffecten”. In English a “side effect” can also be an unwanted thing that happens to you when you're taking a medicine. In Dutch that would be a “bijwerking”, not a “zijeffect”. </p>
</div>

<section class="assignment">
  <h3 class="assignment questions">8.3: side effect or return value?</h3>
  This is the same code you saw in chapter 7. Different questions, of course.
  <script type="text/plain" class="language-arduino">
#include "s4d_breadboard.h"

void setup() {
initializeBreadboard();
}

void loop() {
mapSensorToLed(MAGNETSENSOR, LED_GREEN);
mapSensorToLed(2, 10);
OLED.print("magnet:", stabilizedMagnetValue());
}

void mapSensorToLed(int sensorPin, int ledPin){
analogWrite(ledPin, analogRead(sensorPin) / 4);
}

int stabilizedMagnetValue(){
return analogRead(MAGNETSENSOR) / 100;
}
  </script>
  <ol type="a">
    <li>Does the <code>mapSensorToLed</code> function have a side effect and/or a return value?</li>
    <li>Does the <code>stabilizedMagnetValue</code> function have a side effect and/or a return value?</li>
    <!-- <li>Point out all the parameters in the code (text and line number)</li> -->
    <!-- <li>Point out all the arguments in the code (text and line number)</li> -->
  </ol>
  <answer noslider buttontext="Mail the args and params"></answer>
</section>


  <section class="assignment">
      <h3 class="assignment questions">8.4: side effect or return</h3>
      <p>
        Below are some function calls. Based on the name of the called function, try to explain why you think the function has a side effect or a return value.
      </p>
      <ol type="a">
        <li>add(4,3)</li>
        <li>displayStartScreen()</li>
        <li>Math.random()</li>
        <li>firstNumberFromString("ufd4dsfsal34daf")</li>
        <li>alert()</li>
        <li>Serial.println("Hello!");</li>
      </ol>
      <answer noslider buttontext="Mail the answers"></answer>
  </section>






<section class="assignment">
<h3 class="assignment questions">8.10:</h3>  
<p>Try to summarize what you learned about functions using the output of other functions.</p>
 
<answer buttontext="Mail the code"></answer> -->
</main>  
<aside id="sidebar" include="../agenda.html" reject=".secret"></aside>
<script src='../js/chapters.js'></script>
</body>
</html>